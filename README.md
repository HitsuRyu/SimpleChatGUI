# SimpleChatGUI

## Описание

SimpleChatGUI - программа, имплементирующая простейший сетевой чат – 
защищенную от копирования программу, позволяющую производить регистрацию пользователей – 
создание учетных записей, которые будут храниться в базе данных и при помощи которых пользователи
смогут оставлять сообщения от своего имени.

## Пользователи:

- 9999 : qwerty
- 1000 : passwd
- 1001 : passw1
- 1002 : passw2
- 1003 : passw3
- 1004 : passw4
- 1005 : passw5
- 1006 : passw6
- 1007 : passw7
- 1008 : passw8
- 1009 : passw9
- 1010 : 123456

## Ключи продукта:

 - 07eeb37d335e5de9cda89f870c4394dd8c65bc20
 - 0de35fb19144c27385784df3cf440d37a9edf2bd
 - 1d0250311806b9196b60dd1dad3815621198445f
 - 24cb50a586ab13a81fcc6c68ec4cb75d26a4f72c
 - 47bb825c014b16faba2d72ecc4a512d9f8a28f8c
 - 6cd9d5ac0f45ed1e5c2ed34da1a261059999040e
 - 78a366d28b5ff366d18f6849a523595eef4f1eee
 - 7ffc4c6b5184eab65992b1dbbb33388615e74f66
 - a23f19b9105e43b794203d046c7beb0000f90c50
 - b4368c1d313a0e733f932fb56d8902f0a02b280a
 
 
 ## 1. Цель работы
 Целью работы является разработка защищенного программного модуля
авторизации пользователей. Модуль должен быть защищен от копирования.
Модуль должен обеспечивать создание учетной записи, хранимой в базе
данных, и при помощи нее пользователь должен иметь возможность
оставлять сообщения. Кроме того, пароли пользователей должны храниться в
базе данных в виде хэш-откликов. Каждый пользователь должен обладать
конкретным ограниченным набором прав.
Основные правила:
В БД содержится структура идентификатора и пароля пользователя:
- Идентификатор пользователя представляет собой 4 цифры.
- Пароль – 6 символов цифры или буквы.
В БД содержится справочник атрибутов каждого пользователя:
- ФИО
- Телефон
- Почта
- Адрес

## 2. Описание базы данных
Для данного проекта была выбрана СУБД MySQL, как наиболее
распространенная. Схема выглядит следующим образом:
![изображение](https://user-images.githubusercontent.com/27438197/201470726-20afc532-085f-465a-b906-4a77953f24e9.png)

Таблица Product_Key содержит всего один столбец, в котором хранится
некоторое количество ключей продукта:
![изображение](https://user-images.githubusercontent.com/27438197/201470748-c58445c4-9859-48f3-86b5-9337a56a7331.png)

Предполагается, что эти 10 ключей – это 10 лицензионных копий программы,
которые можно распространить среди потребителей.

Таблица UUID_Table содержит записи вида Ключ Продукта / Идентификатор
ПК:
![изображение](https://user-images.githubusercontent.com/27438197/201470760-4c1ffa19-9fe8-4a0a-8824-d424e38f9589.png)

Она необходима для реализации механизма защиты программы от копирования: если UUID ПК, на котором запущена программа, отсутствует в этой таблице, то пользователь обязан ввести ключ активации, иначе дальнейшая работа программы не будет осуществляться. Аналогично, если ключ активации уже присутствует в этой таблице, то новая машина не будет внесена в эту таблицу, т.к. ключ имеет состояние "уже использован".

Перейдем к таблицам, связанным с пользователями. Основная таблица – это
Login_Pwd, которая содержит в себе идентификаторы пользователей, SHA1
хеши от паролей и графу Permission, которая определяет, какими правами
обладает пользователь: r – чтение, w – запись, rw – чтение и запись.
![изображение](https://user-images.githubusercontent.com/27438197/201470843-6e23174e-f7f9-425d-a830-c65d31249622.png)

## 3. Описание программного модуля
### 3.1. Механизм защиты от копирования
![изображение](https://user-images.githubusercontent.com/27438197/201470879-eb84692b-465a-44e1-ac84-422644eeb321.png)

### 3.2. Примеры работы модуля лицензирования
#### UUID ПК еще не связан с ключом продукта:
![изображение](https://user-images.githubusercontent.com/27438197/201470942-d767e871-da41-4613-960d-be91d0912bbe.png)

В этом случае пользователь вводит неверное значение ключа продукта,
равное any_wrong_product_key – на что программа отвечает сообщением об
ошибке.

#### UUID ПК уже был связан с ключом продукта:
![изображение](https://user-images.githubusercontent.com/27438197/201470977-4cab5712-de84-4719-9aaa-ffd24f391c7c.png)

Программа, проверив наличие записи с уникальным идентификатором ПК в
таблице UUID_Table, разрешает пользователю дальнейшие манипуляции без
требования ввести ключ заново.

### 3.3. Основной модуль
![изображение](https://user-images.githubusercontent.com/27438197/201471017-c7894bd6-b6a7-4a08-a9c6-6722ddb591e7.png)

После ввода логина и пароля, пароль хешируется функцией
SHA1((const unsigned char *)passwd.c_str(), passwd.size(), buf)
Которая содержится в библиотеке openssl, пароль сохраняется в памяти в
виде байтовой строки, преобразованной к символьному массиву.
Соответственно, при регистрации эта строка сохраняется в записи таблицы
БД, и проверка осуществляется именно по хешу от пароля, пароль в
открытом виде в канал связи не попадает.
